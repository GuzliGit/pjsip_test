# Задания для стажировки

<span style="font-size: 1.3em;">[==Задание №1=\=](#задание-1)</span>
<span style="font-size: 1.3em;">[==Задание №2=\=](#задание-2)</span>

## Задание №1 

На основе библиотеки PJSIP реализовать автоответчик для SIP-клиентов (используя framework PJSUA): на любой поступающий вызов выдавать событие “ringing” и через несколько секунд “answer” и далее проигрывать аудио-сигнал/аудио-сообщение используя framework PJMEDIA

**Уровни сложности**:
- [x] Воспроизведение непрерывного аудио-сигнала частотой 425 Гц (длинный гудок) 
- [x] Воспроизведение аудио-сообщения из wav-файла (PCMA/G.711A 64кбит 8кгц моно)
- [x] Воспроизведение повторяющегося аудио-сигнала частотой 425 Гц: 1 секунда гудок, 4 - тишина (имитация КПВ)
- [x] Для любого из пунктов 1.1-1.3 возможность обработать не один, а 20 одновременно поступающих вызовов.
- [x] Воспроизведение в зависимости от набранного номера телефона.

#### Тестирование

С помощью утилиты *sipp* было проведено нагрузочное тестирование, в результате которого программа отработала без ошибок в течение ~1 часа с частотой ~290 звонков в секуду.

## Задание №2

На основе библиотеки PJSIP реализовать приём звонка с одного сетевого интерфейса и передачу вызова на SIP-клиента, находящегося за другим сетевым интерфейсом.

#### Дополнительно

Было интересно попробовать сделать регистрацию, поэтому написал простую реализацию, с которой можно ознакомиться в **registrator.c**. На данный момент регистрация от клиентов не требуется, тестировал через *twinkle*: попытка регистрации проходит успешно, таймер также работает корректно, обновлять регистрацию также нужно вручную.

#### Использование

```./bin/miniSBC <inner_addr> <outer_addr>```

* <inner_addr> - адрес транспорта для внутренней сети
* <outer_addr> - адрес транспорта для внешней сети

Задавать адреса можно в разных форматах: "10.0.0.1:80" или "10.0.0.1" или ":80" или ":".

#### Тестирование

Проводил аналогично первому заданию в *sipp*. Для этого стандартный сценарий uas был немного скорректирован: добавлена передача DTMF 1 через 5 секунд после установления соединения.

В процессе пользовался *Wireshark* для отслеживания пересылки пакетов. В результате тестирования ошибок пока не выявил. RTP пакеты отправляются в обе стороны, звонки может инициировать как клиент с внутренней стороны, так и с внешней.